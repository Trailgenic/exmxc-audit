<!DOCTYPE html>
<html lang="en">
  <head>
    <meta charset="UTF-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    <title>EEI Public Entity Audit</title>
    <script src="https://cdn.tailwindcss.com"></script>

    <style>
      body {
        background-color: #f9fafb;
        font-family: system-ui, -apple-system, Segoe UI, Roboto, Helvetica,
          Arial, sans-serif;
      }
    </style>
  </head>

  <body class="max-w-6xl mx-auto py-10 px-5">
    <!-- HEADER -->
    <header class="mb-6">
      <h1 class="text-3xl font-bold text-gray-900 text-center mb-2">
        EEI Public Entity Audit
      </h1>
      <p class="text-sm text-gray-600 text-center max-w-3xl mx-auto">
        This public view shows your AI-facing entity score, tier summary, and how
        to interpret the ranges. Detailed signal weights and raw diagnostics are
        reserved for internal exmxc.ai analysis.
      </p>
    </header>

    <!-- INPUT PANEL -->
    <section
      class="bg-white border border-gray-200 rounded-xl p-4 mb-6 shadow-sm"
    >
      <div class="flex flex-col md:flex-row md:items-center gap-3">
        <div class="flex-1">
          <label
            for="urlInput"
            class="block text-xs font-semibold text-gray-700 mb-1"
            >URL to audit</label
          >
          <input
            id="urlInput"
            type="text"
            placeholder="example.com"
            class="border border-gray-300 rounded-lg px-3 py-2 w-full text-sm focus:ring-2 focus:ring-black focus:outline-none"
          />
        </div>
        <div class="flex-shrink-0 pt-1">
          <button
            id="runButton"
            class="bg-black text-white text-sm px-5 py-2 rounded-lg hover:bg-gray-800 transition shadow-sm"
          >
            Run Audit
          </button>
        </div>
      </div>
      <p class="text-xs text-gray-500 mt-2">
        Uses <code>/api/audit</code> with current EEI weights. Public view hides
        raw JSON and per-signal weights.
      </p>
    </section>

    <!-- SCORE CARD -->
    <section
      id="scoreCard"
      class="bg-amber-50 border border-amber-200 rounded-xl p-6 mb-8 shadow-sm hidden"
    >
      <div class="flex flex-col md:flex-row md:items-start md:justify-between gap-4">
        <!-- LEFT: MAIN SCORE -->
        <div class="flex-1">
          <div class="text-xs text-gray-600 mb-1" id="entityLabel">
            Entity:
          </div>

          <div class="flex items-center gap-3 mb-2">
            <div class="text-3xl font-bold text-gray-900">
              <span id="scoreValue">--</span>
              <span class="text-lg font-semibold text-gray-500">/ 100</span>
            </div>
            <span
              id="microBadge"
              class="inline-flex items-center px-3 py-1 rounded-full text-[11px] font-semibold bg-emerald-50 text-emerald-700 border border-emerald-200"
            >
              EEI status
            </span>
          </div>

          <!-- BIG SCORE BAR -->
          <div class="w-full h-3 bg-gray-200 rounded-full overflow-hidden mb-3">
            <div
              id="scoreBar"
              class="h-3 rounded-full"
              style="
                width: 0%;
                background: linear-gradient(
                  90deg,
                  #dc2626 0%,
                  #facc15 40%,
                  #22c55e 80%
                );
              "
            ></div>
          </div>

          <!-- STAGE + VERB -->
          <div class="flex items-center gap-2 mb-1">
            <div
              id="stageIcon"
              class="text-base"
              aria-hidden="true"
            >
              ‚òÄÔ∏è
            </div>
            <div class="text-sm font-semibold text-gray-900" id="stageLabel">
              ‚Äî
            </div>
            <button
              id="stageVerb"
              class="ml-2 inline-flex items-center px-2.5 py-0.5 rounded-full text-[11px] font-semibold bg-gray-900 text-white"
            >
              ‚Äî
            </button>
          </div>

          <p
            id="stageDescription"
            class="text-sm text-gray-700 mt-1 max-w-2xl"
          >
            ‚Äî
          </p>
          <p id="stageFocus" class="text-xs text-gray-500 mt-1 max-w-2xl"></p>
        </div>

        <!-- RIGHT: CRAWL HEALTH -->
        <div
          class="w-full md:w-64 bg-white border border-amber-200 rounded-xl p-4 flex flex-col gap-1"
        >
          <div class="flex items-center justify-between mb-1">
            <span class="text-xs font-semibold text-gray-700"
              >Crawl Health</span
            >
            <span class="text-[10px] text-gray-400 uppercase tracking-wide"
              >beta</span
            >
          </div>
          <div class="text-sm text-gray-900" id="crawlCategory">‚Äî</div>
          <div class="text-xs text-gray-500" id="crawlNotes">
            Experimental view of how easily crawlers can access your page.
          </div>
        </div>
      </div>
    </section>

    <!-- TIER SUMMARY -->
    <section class="mb-10 hidden" id="tierSection">
      <h2 class="text-lg font-semibold text-gray-900 mb-3">Tier Summary</h2>
      <div class="grid grid-cols-1 md:grid-cols-3 gap-4">
        <!-- Tier 1 -->
        <div
          class="bg-white border border-gray-200 rounded-xl p-4 shadow-sm flex flex-col"
        >
          <div class="flex items-center justify-between mb-1">
            <span class="text-xs font-semibold text-gray-700">Tier 1</span>
            <span
              class="inline-flex items-center px-2 py-0.5 rounded-full text-[10px] font-medium bg-gray-100 text-gray-700"
              >Entity comprehension &amp; trust</span
            >
          </div>
          <div class="text-sm text-gray-900 mb-1">
            <span id="tier1Score">0.0</span>
            <span class="text-gray-500"> / 100</span>
          </div>
          <div class="w-full h-2 bg-gray-200 rounded-full overflow-hidden mb-1">
            <div
              id="tier1Bar"
              class="h-2 rounded-full bg-amber-400"
              style="width: 0%"
            ></div>
          </div>
          <div class="text-[11px] text-gray-500" id="tier1Raw">Raw 0 / 0</div>
        </div>

        <!-- Tier 2 -->
        <div
          class="bg-white border border-gray-200 rounded-xl p-4 shadow-sm flex flex-col"
        >
          <div class="flex items-center justify-between mb-1">
            <span class="text-xs font-semibold text-gray-700">Tier 2</span>
            <span
              class="inline-flex items-center px-2 py-0.5 rounded-full text-[10px] font-medium bg-gray-100 text-gray-700"
              >Structural data fidelity</span
            >
          </div>
          <div class="text-sm text-gray-900 mb-1">
            <span id="tier2Score">0.0</span>
            <span class="text-gray-500"> / 100</span>
          </div>
          <div class="w-full h-2 bg-gray-200 rounded-full overflow-hidden mb-1">
            <div
              id="tier2Bar"
              class="h-2 rounded-full bg-emerald-500"
              style="width: 0%"
            ></div>
          </div>
          <div class="text-[11px] text-gray-500" id="tier2Raw">Raw 0 / 0</div>
        </div>

        <!-- Tier 3 -->
        <div
          class="bg-white border border-gray-200 rounded-xl p-4 shadow-sm flex flex-col"
        >
          <div class="flex items-center justify-between mb-1">
            <span class="text-xs font-semibold text-gray-700">Tier 3</span>
            <span
              class="inline-flex items-center px-2 py-0.5 rounded-full text-[10px] font-medium bg-gray-100 text-gray-700"
              >Page-level hygiene</span
            >
          </div>
          <div class="text-sm text-gray-900 mb-1">
            <span id="tier3Score">0.0</span>
            <span class="text-gray-500"> / 100</span>
          </div>
          <div class="w-full h-2 bg-gray-200 rounded-full overflow-hidden mb-1">
            <div
              id="tier3Bar"
              class="h-2 rounded-full bg-emerald-500"
              style="width: 0%"
            ></div>
          </div>
          <div class="text-[11px] text-gray-500" id="tier3Raw">Raw 0 / 0</div>
        </div>
      </div>
    </section>

    <!-- SCORING INTERPRETATION -->
<section class="mb-8">
  <h2 class="text-lg font-semibold text-gray-900 mb-3 text-center">
    Scoring Interpretation
  </h2>

  <div class="bg-white border border-gray-200 rounded-xl p-4 shadow-sm max-w-3xl mx-auto">
    <div class="overflow-x-auto">
      <table class="min-w-full text-sm mx-auto">
        <thead>
          <tr class="border-b border-gray-200">
            <th class="text-left text-xs font-semibold text-gray-500 pb-2 pr-4">
              Score Range
            </th>
            <th class="text-left text-xs font-semibold text-gray-500 pb-2">
              Meaning
            </th>
          </tr>
        </thead>

        <tbody class="align-top">
          <tr class="border-b border-gray-100">
            <td class="py-2 pr-4 text-xs text-gray-700">0‚Äì39</td>
            <td class="py-2 text-xs text-gray-800">
              <span class="font-semibold">Unstructured</span> ‚Äî AI cannot reliably interpret your entity.
            </td>
          </tr>

          <tr class="border-b border-gray-100">
            <td class="py-2 pr-4 text-xs text-gray-700">40‚Äì49</td>
            <td class="py-2 text-xs text-gray-800">
              <span class="font-semibold">Weakly visible</span> ‚Äî AI sees your entity but lacks confidence.
            </td>
          </tr>

          <tr class="border-b border-gray-100">
            <td class="py-2 pr-4 text-xs text-gray-700">50‚Äì59</td>
            <td class="py-2 text-xs text-gray-800">
              <span class="font-semibold">Visible</span> ‚Äî AI sees your entity but may not believe it.
            </td>
          </tr>

          <tr class="border-b border-gray-100">
            <td class="py-2 pr-4 text-xs text-gray-700">60‚Äì69</td>
            <td class="py-2 text-xs text-gray-800">
              <span class="font-semibold">Fragile Structure</span> ‚Äî AI can collapse this interpretation anytime.
            </td>
          </tr>

          <tr class="border-b border-gray-100">
            <td class="py-2 pr-4 text-xs text-gray-700">70‚Äì79</td>
            <td class="py-2 text-xs text-gray-800">
              <span class="font-semibold">Stable Structure</span> ‚Äî AI can use your entity but may not cite it.
            </td>
          </tr>

          <tr>
            <td class="py-2 pr-4 text-xs text-gray-700">80+</td>
            <td class="py-2 text-xs text-gray-800">
              <span class="font-semibold">Trusted</span> ‚Äî AI trusts your entity and elevates it.
            </td>
          </tr>
        </tbody>
      </table>
    </div>
  </div>
</section>

    <!-- SIGNALS EVALUATED -->
<section class="mb-10">
  <h2 class="text-lg font-semibold text-gray-900 mb-3 text-center">
    Signals Evaluated
  </h2>

  <div class="bg-white border border-gray-200 rounded-xl p-4 shadow-sm max-w-3xl mx-auto">
    <ul class="list-disc pl-6 text-sm text-gray-800 space-y-1 mx-auto">
      <li>Title Precision</li>
      <li>Meta Description Integrity</li>
      <li>Canonical Clarity</li>
      <li>Schema Presence &amp; Validity</li>
      <li>Organization Schema</li>
      <li>Breadcrumb Schema</li>
      <li>Author/Person Schema</li>
      <li>Social Entity Links</li>
      <li>AI Crawl Fidelity</li>
      <li>Inference Efficiency</li>
      <li>Internal Lattice Integrity</li>
      <li>External Authority Signal</li>
      <li>Brand &amp; Technical Consistency</li>
    </ul>
  </div>
</section>


    <!-- FOOTER -->
    <footer class="text-center text-xs text-gray-500 mt-8 pt-4 border-t">
      <div class="mb-1">
        Powered by <span class="font-semibold text-black">exmxc.ai</span>
      </div>
      <div>
        For detailed strategic review:
        <a
          href="mailto:mike@trailgenic.com"
          class="text-gray-800 font-semibold underline"
          >mike@trailgenic.com</a
        >
      </div>
    </footer>

    <!-- SCRIPT -->
    <script>
      const runButton = document.getElementById("runButton");
      const scoreCard = document.getElementById("scoreCard");
      const tierSection = document.getElementById("tierSection");

      const entityLabel = document.getElementById("entityLabel");
      const scoreValue = document.getElementById("scoreValue");
      const microBadge = document.getElementById("microBadge");
      const scoreBar = document.getElementById("scoreBar");
      const stageIcon = document.getElementById("stageIcon");
      const stageLabel = document.getElementById("stageLabel");
      const stageVerb = document.getElementById("stageVerb");
      const stageDescription = document.getElementById("stageDescription");
      const stageFocus = document.getElementById("stageFocus");
      const crawlCategory = document.getElementById("crawlCategory");
      const crawlNotes = document.getElementById("crawlNotes");

      const tier1Score = document.getElementById("tier1Score");
      const tier1Bar = document.getElementById("tier1Bar");
      const tier1Raw = document.getElementById("tier1Raw");
      const tier2Score = document.getElementById("tier2Score");
      const tier2Bar = document.getElementById("tier2Bar");
      const tier2Raw = document.getElementById("tier2Raw");
      const tier3Score = document.getElementById("tier3Score");
      const tier3Bar = document.getElementById("tier3Bar");
      const tier3Raw = document.getElementById("tier3Raw");

      function normalizeUrl(input) {
        let url = (input || "").trim();
        if (!url) return null;
        if (!/^https?:\/\//i.test(url)) url = `https://${url}`;
        try {
          return new URL(url).toString();
        } catch {
          return null;
        }
      }

      function microStateLabel(score) {
        if (score >= 80) return "Trusted sovereign entity";
        if (score >= 70) return "Stable but not yet cited";
        if (score >= 60) return "Fragile structure";
        if (score >= 50) return "Visible but untrusted";
        if (score >= 40) return "Weakly visible";
        return "Unstructured / low visibility";
      }

      function stageEmoji(stageText) {
        if (!stageText) return "üåë";
        if (stageText.includes("Sovereign")) return "‚òÄÔ∏è";
        if (stageText.includes("Structured")) return "üåï";
        if (stageText.includes("Visible")) return "üåó";
        return "üåë";
      }

      runButton.addEventListener("click", async () => {
        const input = document.getElementById("urlInput").value;
        const normalized = normalizeUrl(input);

        if (!normalized) {
          alert("Please enter a valid URL.");
          return;
        }

        runButton.disabled = true;
        runButton.textContent = "Running...";

        try {
          const res = await fetch(
            `/api/eei-public?url=${encodeURIComponent(normalized)}`
          );

          const data = await res.json();

          if (!data.success) {
            alert(data.error || "Audit failed.");
            runButton.disabled = false;
            runButton.textContent = "Run Audit";
            return;
          }

          // === MAIN SCORE ===
          const score = data.entityScore ?? 0;
          const entityName = data.entityName || data.hostname || "Unknown entity";

          entityLabel.textContent = `Entity: ${entityName}`;
          scoreValue.textContent = score.toString();
          microBadge.textContent = microStateLabel(score);

          scoreBar.style.width = `${score}%`;
          scoreBar.style.background =
            "linear-gradient(90deg, #dc2626 0%, #facc15 40%, #22c55e 80%)";

          const stageText = data.entityStage || "";
          stageLabel.textContent = stageText;
          stageIcon.textContent = stageEmoji(stageText);
          stageVerb.textContent = data.entityVerb || "";
          stageDescription.textContent =
            data.entityDescription ||
            "AI-facing interpretation of your current entity state.";
          stageFocus.textContent = data.entityFocus || "";

          // === CRAWL HEALTH (best-effort) ===
          const ch = data.crawlHealth || {};
          if (ch.category) {
            crawlCategory.textContent = ch.category;
          } else {
            crawlCategory.textContent = "Crawl diagnostics available internally.";
          }
          if (Array.isArray(ch.notes) && ch.notes.length > 0) {
            crawlNotes.textContent = ch.notes[0];
          } else {
            crawlNotes.textContent =
              "Experimental view of how easily crawlers can access your page.";
          }

          scoreCard.classList.remove("hidden");

          // === TIER SUMMARY ===
          const tiers = data.tierScores || {};
          const t1 = tiers.tier1 || { normalized: 0, raw: 0, maxWeight: 0 };
          const t2 = tiers.tier2 || { normalized: 0, raw: 0, maxWeight: 0 };
          const t3 = tiers.tier3 || { normalized: 0, raw: 0, maxWeight: 0 };

          function fmt(val) {
            return Number.isFinite(val) ? val.toFixed(1) : "0.0";
          }

          tier1Score.textContent = fmt(t1.normalized || 0);
          tier2Score.textContent = fmt(t2.normalized || 0);
          tier3Score.textContent = fmt(t3.normalized || 0);

          tier1Bar.style.width = `${Math.min(t1.normalized || 0, 100)}%`;
          tier2Bar.style.width = `${Math.min(t2.normalized || 0, 100)}%`;
          tier3Bar.style.width = `${Math.min(t3.normalized || 0, 100)}%`;

          tier1Raw.textContent = `Raw ${t1.raw || 0} / ${t1.maxWeight || 0}`;
          tier2Raw.textContent = `Raw ${t2.raw || 0} / ${t2.maxWeight || 0}`;
          tier3Raw.textContent = `Raw ${t3.raw || 0} / ${t3.maxWeight || 0}`;

          tierSection.classList.remove("hidden");
        } catch (err) {
          alert("Error running audit: " + err.message);
        } finally {
          runButton.disabled = false;
          runButton.textContent = "Run Audit";
        }
      });
    </script>
  </body>
</html>
