<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="UTF-8" />
<title>Internal Entity Clarity Review — v7.0</title>
<meta name="viewport" content="width=device-width, initial-scale=1.0" />

<style>
:root {
  --bg:#050914;
  --panel:#0b1224;
  --border:#1e2a4a;
  --text:#e6ebff;
  --muted:#9aa4c7;
  --accent:#4f7cff;
  --gold:#ffd85e;
  --green:#4ade80;
  --orange:#fb923c;
  --red:#ef4444;
}

* { box-sizing:border-box; }

body{
  margin:0;
  font-family:system-ui,-apple-system,Segoe UI,Roboto,sans-serif;
  background:radial-gradient(circle at top,#0a1024,#030611);
  color:var(--text);
}

.container{
  max-width:1200px;
  margin:40px auto;
  padding:0 20px;
}

input{
  flex:1;
  padding:14px 16px;
  border-radius:10px;
  border:1px solid var(--border);
  background:var(--panel);
  color:var(--text);
}

button{
  padding:14px 22px;
  border-radius:10px;
  border:none;
  background:linear-gradient(135deg,#4f7cff,#6f9bff);
  color:white;
  font-weight:600;
  cursor:pointer;
}

.panel{
  background:linear-gradient(180deg,#0b1224,#060b1c);
  border:1px solid var(--border);
  border-radius:14px;
  padding:20px;
}

.top-grid{
  display:grid;
  grid-template-columns:1fr 1.1fr;
  gap:20px;
}

/* POSTURE CARD */
.posture-box{
  display:flex;
  flex-direction:column;
  gap:14px;
}

.posture-badge{
  display:inline-block;
  padding:8px 14px;
  border-radius:999px;
  border:1px solid var(--border);
  font-weight:600;
  font-size:13px;
}

.posture-open{ background:rgba(79,124,255,.08); border-color:#4f7cff; }
.posture-defensive{ background:rgba(251,146,60,.08); border-color:#fb923c; }
.posture-blocked{ background:rgba(239,68,68,.08); border-color:#ef4444; }

/* SCORE DISC */
.center-score{
  width:120px;
  height:120px;
  border-radius:50%;
  border:2px solid var(--accent);
  display:flex;
  flex-direction:column;
  align-items:center;
  justify-content:center;
  margin-top:10px;
}

.center-score span{
  font-size:34px;
  font-weight:800;
}

/* TIERS */
.tier{
  margin-top:10px;
}

.bar{
  margin-top:6px;
  height:10px;
  border-radius:6px;
  background:#020617;
  border:1px solid var(--border);
}

.fill{
  height:100%;
  border-radius:6px;
  background:linear-gradient(90deg,#4f7cff,#6f9bff);
}

/* JSON Panels */
pre{
  background:#020617;
  padding:14px;
  border-radius:10px;
  font-size:12px;
  overflow-x:auto;
}
</style>
</head>

<body>
<div class="container">
  <h1>EEI Internal Audit — v7.0</h1>

  <div style="display:flex;gap:12px;margin-bottom:20px;">
    <input id="urlInput" placeholder="example.com">
    <button id="runBtn">Run Audit</button>
  </div>

  <div id="results" style="display:none;">

    <div class="top-grid">

      <!-- LEFT PANEL -->
      <div class="panel">
        <div class="posture-box">
          <h3>Strategic Posture</h3>

          <div id="postureBadge" class="posture-badge">—</div>
          <div id="postureExplain" style="color:var(--muted);font-size:14px;"></div>

          <div class="center-score">
            <span id="score">–</span>
            <small>Capability Score</small>
          </div>

          <div id="capabilityBand" style="margin-top:6px;font-weight:600;"></div>
        </div>
      </div>

      <!-- RIGHT PANEL -->
      <div class="panel">
        <h3>Tier Stability</h3>
        <div id="tiers"></div>
      </div>

    </div>

    <!-- EVIDENCE -->
    <details class="panel" style="margin-top:18px;">
      <summary>Signal Breakdown</summary>
      <pre id="evidence"></pre>
    </details>

    <!-- RAW JSON -->
    <details class="panel">
      <summary>Raw JSON</summary>
      <pre id="raw"></pre>
    </details>

  </div>
</div>

<script>
const runBtn=document.getElementById("runBtn");
const results=document.getElementById("results");

function renderTiers(tiers){
  const root=document.getElementById("tiers");
  root.innerHTML="";
  for(const k of Object.keys(tiers)){
    const t=tiers[k];
    const div=document.createElement("div");
    div.className="tier";
    div.innerHTML=`
      <label>${t.label}</label>
      <div class="bar">
        <div class="fill" style="width:${t.normalized}%"></div>
      </div>
    `;
    root.appendChild(div);
  }
}

function renderEvidence(breakdown=[]){
  return breakdown.map(b =>
    `${b.key} — ${b.points}/${b.max}${b.notes?` — ${b.notes}`:""}`
  ).join("\\n");
}

runBtn.onclick=async()=>{
  const url=document.getElementById("urlInput").value.trim();
  if(!url) return;

  runBtn.disabled=true;
  runBtn.textContent="Running…";
  results.style.display="none";

  const res=await fetch(`/api/audit?url=${encodeURIComponent(url)}`);
  const data=await res.json();

  runBtn.disabled=false;
  runBtn.textContent="Run Audit";

  // POSTURE BADGE
  const pb=document.getElementById("postureBadge");
  pb.textContent=data.posture;

  pb.className="posture-badge";
  if(data.posture==="Open") pb.classList.add("posture-open");
  else if(data.posture==="Defensive") pb.classList.add("posture-defensive");
  else pb.classList.add("posture-blocked");

  document.getElementById("postureExplain").textContent=data.postureExplanation||"";
  document.getElementById("score").textContent=data.eccScore ?? "–";
  document.getElementById("capabilityBand").textContent=`Capability Band: ${data.capability?.band||"—"}`;

  // TIER BARS
  if(data.tierScores) renderTiers(data.tierScores);
  else document.getElementById("tiers").innerHTML="<em>No scoring — posture is Blocked.</em>";

  // Evidence & Raw
  document.getElementById("evidence").textContent=renderEvidence(data.breakdown||[]);
  document.getElementById("raw").textContent=JSON.stringify(data,null,2);

  results.style.display="block";
};
</script>
</body>
</html>
