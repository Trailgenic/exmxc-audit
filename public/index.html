<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="UTF-8" />
<title>EEI Internal Audit — v7.0</title>
<meta name="viewport" content="width=device-width, initial-scale=1.0" />

<style>
:root {
  --bg:#050912;
  --panel:#0b1222;
  --border:#1e2a45;
  --text:#e7ebff;
  --muted:#9aa4c7;
  --accent:#4f7cff;
  --green:#22c55e;
  --amber:#f59e0b;
  --red:#ef4444;
}

*{box-sizing:border-box;}

body{
  margin:0;
  font-family:system-ui,-apple-system,Segoe UI,Roboto,sans-serif;
  background:radial-gradient(circle at top,#0a1024,#020510);
  color:var(--text);
}

.container{
  max-width:1200px;
  margin:32px auto;
  padding:0 16px;
}

h1{margin-bottom:10px;}

.input-row{
  display:flex;
  gap:10px;
  margin-bottom:22px;
}

input{
  flex:1;
  padding:14px 16px;
  border-radius:10px;
  border:1px solid var(--border);
  background:var(--panel);
  color:var(--text);
}

button{
  padding:14px 22px;
  border-radius:10px;
  border:none;
  background:linear-gradient(135deg,#4f7cff,#6f9bff);
  color:white;
  font-weight:600;
  cursor:pointer;
}

.panel{
  background:linear-gradient(180deg,#0b1224,#060b1c);
  border:1px solid var(--border);
  border-radius:14px;
  padding:18px;
}

.grid{
  display:grid;
  grid-template-columns:1fr 1fr;
  gap:18px;
}

.state-bar{
  width:100%;
  height:10px;
  border-radius:8px;
  background:#0f172a;
  margin:10px 0 8px 0;
  overflow:hidden;
}

.state-fill{
  height:100%;
  width:100%;
  border-radius:8px;
}

.score-wrapper{
  margin-top:20px;
  display:flex;
  align-items:center;
  gap:14px;
}

.score-circle{
  width:110px;
  height:110px;
  border-radius:50%;
  display:flex;
  align-items:center;
  justify-content:center;
  border:2px solid var(--accent);
  font-size:34px;
  font-weight:700;
}

.tier-bar{
  width:100%;
  height:8px;
  border-radius:6px;
  background:#111827;
  margin-top:6px;
}

.tier-fill{
  height:100%;
  border-radius:6px;
  background:#6f9bff;
}

ul{margin-top:8px;}
pre{
  background:#020617;
  padding:14px;
  border-radius:10px;
  font-size:12px;
  overflow-x:auto;
}
</style>
</head>

<body>
<div class="container">
  <h1>EEI Internal Audit — v7.0</h1>

  <div class="input-row">
    <input id="urlInput" placeholder="example.com" />
    <button id="runBtn">Run Audit</button>
  </div>

  <div id="results" style="display:none;">

    <div class="grid">

      <!-- STRATEGIC POSTURE -->
      <div class="panel">
        <strong>Strategic Posture</strong>
        <div id="postureLabel" style="margin-top:6px;color:var(--muted);">—</div>

        <div class="state-bar">
          <div id="postureFill" class="state-fill"></div>
        </div>

        <div class="score-wrapper">
          <div class="score-circle" id="scoreValue">—</div>
          <div>
            <div style="font-size:12px;color:var(--muted);">Capability Band</div>
            <div id="scoreBand" style="font-size:18px;">—</div>
          </div>
        </div>
      </div>

      <!-- TIER STABILITY -->
      <div class="panel">
        <strong>Tier Stability</strong>

        <div style="margin-top:10px;">Entity comprehension & trust</div>
        <div class="tier-bar"><div id="tier1Bar" class="tier-fill"></div></div>

        <div style="margin-top:10px;">Structural data fidelity</div>
        <div class="tier-bar"><div id="tier2Bar" class="tier-fill"></div></div>

        <div style="margin-top:10px;">Page-level hygiene</div>
        <div class="tier-bar"><div id="tier3Bar" class="tier-fill"></div></div>
      </div>

    </div>

    <!-- BREAKDOWN -->
    <div class="panel" style="margin-top:18px;">
      <strong>Signal Breakdown</strong>
      <ul id="signalsList"></ul>
    </div>

    <!-- RAW -->
    <details class="panel" style="margin-top:12px;">
      <summary>Raw JSON</summary>
      <pre id="raw"></pre>
    </details>

  </div>
</div>

<script>
const runBtn = document.getElementById("runBtn");
const results = document.getElementById("results");

runBtn.onclick = async () => {
  const url = document.getElementById("urlInput").value.trim();
  if (!url) return;

  runBtn.disabled = true;
  runBtn.textContent = "Running…";

  try {
    const res = await fetch(`/api/audit?url=${encodeURIComponent(url)}`);
    const data = await res.json();

    runBtn.disabled = false;
    runBtn.textContent = "Run Audit";

    if (!data.success){
      alert("Audit failed");
      return;
    }

    results.style.display = "block";

    /* =========================
       STRATEGIC POSTURE
    ==========================*/
    const bar = document.getElementById("postureFill");
    const label = document.getElementById("postureLabel");

    if (data.state === "blocked"){
      bar.style.background = "var(--red)";
      label.textContent = "Blocked — Hard Access Controls";
    }
    else if (data.state === "defensive"){
      bar.style.background = "var(--amber)";
      label.textContent = "Defensive — Partial Visibility / Bot Friction";
    }
    else{
      bar.style.background = "var(--green)";
      label.textContent = "Open — AI-Forward Surface";
    }

    /* =========================
       CAPABILITY SCORE
    ==========================*/
    const score = data.ecc?.score ?? "—";
    document.getElementById("scoreValue").textContent = score;

    let band = "Low";
    if (score >= 70) band = "High";
    else if (score >= 40) band = "Medium";

    document.getElementById("scoreBand").textContent = band;

    /* =========================
       TIER STABILITY
    ==========================*/
    function setTier(id,val){
      document.getElementById(id).style.width = `${val}%`;
    }

    setTier("tier1Bar", data.tierScores?.tier1?.normalized ?? 0);
    setTier("tier2Bar", data.tierScores?.tier2?.normalized ?? 0);
    setTier("tier3Bar", data.tierScores?.tier3?.normalized ?? 0);

    /* =========================
       BREAKDOWN LIST
    ==========================*/
    document.getElementById("signalsList").innerHTML =
      (data.scoringBars || []).map(r =>
        `<li><strong>${r.key}</strong> — ${r.percent}% <em style="color:#9aa4c7">${r.notes||""}</em></li>`
      ).join("");

    /* =========================
       RAW JSON
    ==========================*/
    document.getElementById("raw").textContent =
      JSON.stringify(data,null,2);

  } catch(err){
    runBtn.disabled = false;
    runBtn.textContent = "Run Audit";
    alert("Request failed");
  }
};
</script>
</body>
</html>
