<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0" />
  <title>EEI Single URL Audit — Internal</title>
  <script src="https://cdn.tailwindcss.com"></script>
  <style>
    body {
      background-color: #f9fafb;
      font-family: system-ui, -apple-system, Segoe UI, Roboto, Helvetica, Arial, sans-serif;
    }
    .json-box {
      background-color: #020617;
      color: #e2e8f0;
      padding: 1rem;
      border-radius: 0.75rem;
      font-size: 0.85rem;
      white-space: pre-wrap;
      overflow-x: auto;
    }
    .badge {
      font-size: 0.7rem;
      padding: 0.15rem 0.5rem;
      border-radius: 999px;
    }
  </style>
</head>

<body class="max-w-6xl mx-auto py-10 px-5">

<header class="mb-8">
  <div class="flex justify-between items-start">
    <div>
      <h1 class="text-3xl font-bold text-gray-900">
        EEI Single URL Audit <span class="text-xs text-gray-500">INTERNAL</span>
      </h1>
      <p class="text-sm text-gray-600 mt-1">
        exmxc.ai · Entity Engineering Index — full 13-signal diagnostic
      </p>
    </div>
    <div class="text-xs text-gray-500 text-right">
      <div>Powered by <strong>exmxc.ai</strong></div>
      <div id="timestamp"></div>
    </div>
  </div>
</header>

<section class="bg-white border rounded-xl p-4 mb-6 shadow-sm">
  <label class="text-xs text-gray-600">URL to audit</label>
  <div class="flex gap-2 mt-1">
    <input id="urlInput" class="flex-1 border rounded px-3 py-2 text-sm" placeholder="example.com" />
    <button id="runButton" class="bg-black text-white px-4 py-2 rounded">
      Run Audit
    </button>
  </div>
</section>

<section class="bg-amber-50 border border-amber-200 rounded-xl p-6 mb-8">
  <div class="flex justify-between gap-6">

    <div>
      <div id="entityName" class="text-sm font-semibold text-gray-800"></div>

      <div class="flex items-center gap-2 mt-1">
        <div id="scoreDisplay" class="text-3xl font-bold">EEI: -- / 100</div>
        <span id="scoreBadge" class="badge bg-gray-200">Awaiting</span>
      </div>

      <div class="w-full h-3 bg-gray-200 rounded-full mt-3">
        <div id="scoreBar" class="h-3 rounded-full"></div>
      </div>

      <div class="mt-2">
        <div id="entityStage" class="font-semibold"></div>
        <div id="entityVerb" class="text-xs text-gray-700"></div>
        <div id="entityFocus" class="text-xs text-gray-500"></div>
      </div>
    </div>

    <div class="bg-white border rounded-lg p-3 w-64 text-xs">
      <div class="flex justify-between mb-1">
        <span class="font-semibold">Crawl Health</span>
        <span id="crawlHealthScore" class="badge bg-gray-200">--</span>
      </div>
      <div id="crawlHealthCategory" class="mb-1">—</div>
      <ul id="crawlHealthNotes" class="list-disc pl-4 space-y-0.5"></ul>
    </div>

  </div>
</section>

<section class="mb-8">
  <h2 class="text-sm font-semibold mb-2">Tier Summary</h2>
  <div class="grid grid-cols-3 gap-3 text-xs">
    <div class="bg-white border rounded p-3">
      <strong>Tier 1</strong>
      <div id="tier1Score">--</div>
      <div class="h-2 bg-gray-200 rounded"><div id="tier1Bar" class="h-2 rounded"></div></div>
      <div id="tier1Meta" class="text-[11px] text-gray-500 mt-1"></div>
    </div>
    <div class="bg-white border rounded p-3">
      <strong>Tier 2</strong>
      <div id="tier2Score">--</div>
      <div class="h-2 bg-gray-200 rounded"><div id="tier2Bar" class="h-2 rounded"></div></div>
      <div id="tier2Meta" class="text-[11px] text-gray-500 mt-1"></div>
    </div>
    <div class="bg-white border rounded p-3">
      <strong>Tier 3</strong>
      <div id="tier3Score">--</div>
      <div class="h-2 bg-gray-200 rounded"><div id="tier3Bar" class="h-2 rounded"></div></div>
      <div id="tier3Meta" class="text-[11px] text-gray-500 mt-1"></div>
    </div>
  </div>
</section>

<section class="mb-10">
  <h2 class="text-sm font-semibold mb-4">13 Signal Breakdown</h2>
  <div class="grid grid-cols-1 md:grid-cols-2 gap-6 text-sm">
    <div class="bg-white border rounded-xl p-4"><h3 class="font-semibold mb-2">Meta Signals</h3><div id="metaSignals" class="space-y-4"></div></div>
    <div class="bg-white border rounded-xl p-4"><h3 class="font-semibold mb-2">Schema Signals</h3><div id="schemaSignals" class="space-y-4"></div></div>
    <div class="bg-white border rounded-xl p-4"><h3 class="font-semibold mb-2">Lattice & Crawl Signals</h3><div id="latticeSignals" class="space-y-4"></div></div>
    <div class="bg-white border rounded-xl p-4"><h3 class="font-semibold mb-2">Content Signals</h3><div id="contentSignals" class="space-y-4"></div></div>
  </div>
</section>

<section>
  <h2 class="text-sm font-semibold mb-2">Raw JSON</h2>
  <pre id="result" class="json-box">// Awaiting input…</pre>
</section>

<script>
const GROUPS = {
  meta: ["Title Precision","Meta Description Integrity","Canonical Clarity","Brand & Technical Consistency"],
  schema: ["Schema Presence & Validity","Organization Schema","Breadcrumb Schema","Author/Person Schema"],
  lattice: ["Internal Lattice Integrity","External Authority Signal","Social Entity Links","AI Crawl Fidelity"],
  content: ["Inference Efficiency"]
};

const TIER_MAP = {
  tier1: ["Inference Efficiency","Internal Lattice Integrity","External Authority Signal","Social Entity Links","AI Crawl Fidelity"],
  tier2: ["Schema Presence & Validity","Organization Schema","Breadcrumb Schema","Author/Person Schema"],
  tier3: ["Title Precision","Meta Description Integrity","Canonical Clarity","Brand & Technical Consistency"]
};

const color = pct => pct >= 80 ? "bg-green-500" : pct >= 60 ? "bg-yellow-400" : pct >= 40 ? "bg-orange-400" : "bg-red-500";

const renderSignal = s => {
  const pct = Math.round((s.points / s.max) * 100);
  const d = document.createElement("div");
  d.innerHTML = `
    <div class="flex justify-between text-xs mb-1">
      <span class="font-medium">${s.key}</span>
      <span>${s.points}/${s.max}</span>
    </div>
    <div class="h-2 bg-gray-200 rounded">
      <div class="h-2 rounded ${color(pct)}" style="width:${pct}%"></div>
    </div>
    <div class="text-[11px] text-gray-500">${s.notes || ""}</div>
  `;
  return d;
};

const computeTier = (b, keys) => {
  let raw = 0, max = 0;
  b.forEach(s => keys.includes(s.key) && ((raw += s.points),(max += s.max)));
  return { raw, max, pct: max ? Math.round(raw / max * 100) : 0 };
};

const setTier = (scoreEl, barEl, metaEl, t) => {
  scoreEl.textContent = `${t.pct}/100`;
  barEl.style.width = `${t.pct}%`;
  barEl.className = `h-2 rounded ${color(t.pct)}`;
  metaEl.textContent = `Raw ${t.raw} / ${t.max}`;
};

const deriveCrawlHealth = ch => {
  let score = 50, notes = [];
  if (ch.mode === "rendered") { score += 20; notes.push("Rendered crawl"); }
  if (ch.wordCount >= 1500) { score += 20; notes.push("Deep content"); }
  if (ch.internalLinkRatio === 1) { score += 20; notes.push("Perfect lattice"); }
  return { score: Math.min(score,100), category: ch.mode, notes };
};

document.getElementById("runButton").onclick = async () => {
  const input = urlInput.value.trim();
  if (!input) return;
  const url = input.startsWith("http") ? input : `https://${input}`;

  const res = await fetch(`https://exmxc-audit.vercel.app/api/audit?url=${encodeURIComponent(url)}`, {
    headers: { "x-exmxc-key": "exmxc-internal" }
  });
  const data = await res.json();
  result.textContent = JSON.stringify(data, null, 2);
  timestamp.textContent = `Last run: ${new Date().toLocaleString()}`;

  const score = data.entityScore;
  scoreDisplay.textContent = `EEI: ${score} / 100`;
  scoreBar.style.width = `${score}%`;
  scoreBar.className = `h-3 rounded-full ${color(score)}`;
  scoreBadge.textContent = data.entityStage;
  scoreBadge.className = `badge ${score >= 80 ? "bg-green-100 text-green-800" : "bg-yellow-100"}`;

  entityName.textContent = `Entity: ${data.entityName}`;
  entityStage.textContent = data.entityStage;
  entityVerb.textContent = data.entityVerb;
  entityFocus.textContent = data.entityFocus;

  metaSignals.innerHTML = schemaSignals.innerHTML = latticeSignals.innerHTML = contentSignals.innerHTML = "";
  data.breakdown.forEach(s => {
    if (GROUPS.meta.includes(s.key)) metaSignals.appendChild(renderSignal(s));
    if (GROUPS.schema.includes(s.key)) schemaSignals.appendChild(renderSignal(s));
    if (GROUPS.lattice.includes(s.key)) latticeSignals.appendChild(renderSignal(s));
    if (GROUPS.content.includes(s.key)) contentSignals.appendChild(renderSignal(s));
  });

  setTier(tier1Score, tier1Bar, tier1Meta, computeTier(data.breakdown, TIER_MAP.tier1));
  setTier(tier2Score, tier2Bar, tier2Meta, computeTier(data.breakdown, TIER_MAP.tier2));
  setTier(tier3Score, tier3Bar, tier3Meta, computeTier(data.breakdown, TIER_MAP.tier3));

  const ch = deriveCrawlHealth(data.crawlHealth);
  crawlHealthScore.textContent = `${ch.score}/100`;
  crawlHealthScore.className = `badge ${color(ch.score)} text-white`;
  crawlHealthCategory.textContent = ch.category;
  crawlHealthNotes.innerHTML = ch.notes.map(n => `<li>${n}</li>`).join("");
};
</script>

</body>
</html>
