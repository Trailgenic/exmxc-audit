<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8" />
  <title>exmxc.ai — Entity Engineering Index</title>
  <meta name="viewport" content="width=device-width, initial-scale=1" />

  <!-- Tailwind CDN (no build step) -->
  <script src="https://cdn.tailwindcss.com"></script>

  <style>
    body {
      background: #020617;
      color: #e5e7eb;
      font-family: system-ui, -apple-system, BlinkMacSystemFont, "Segoe UI", Roboto;
    }
    .card {
      background: #020617;
      border: 1px solid #1e293b;
      border-radius: 0.75rem;
    }
    .muted {
      color: #94a3b8;
    }
  </style>
</head>

<body class="min-h-screen">

  <!-- Header -->
  <header class="border-b border-slate-800 p-6">
    <h1 class="text-xl font-semibold tracking-tight">Entity Engineering Index</h1>
    <p class="muted text-sm">AI-search capability & intent diagnostics</p>
  </header>

  <!-- Input -->
  <section class="p-6 max-w-5xl mx-auto">
    <div class="flex gap-3">
      <input
        id="urlInput"
        placeholder="https://example.com"
        class="flex-1 bg-slate-900 border border-slate-700 rounded px-3 py-2 text-sm"
      />
      <button
        id="runBtn"
        class="bg-indigo-600 hover:bg-indigo-500 px-4 py-2 rounded text-sm font-medium"
      >
        Run Audit
      </button>
    </div>
  </section>

  <!-- Results -->
  <main id="results" class="hidden max-w-5xl mx-auto p-6 space-y-6">

    <!-- HERO -->
    <section class="card p-6 grid md:grid-cols-3 gap-6">
      <div class="md:col-span-2">
        <h2 id="entityName" class="text-2xl font-semibold"></h2>
        <p id="quadrant" class="text-lg mt-2"></p>
        <p id="interpretation" class="muted mt-3 text-sm"></p>
      </div>

      <div class="flex flex-col gap-3">
        <span id="capabilityChip" class="px-3 py-1 rounded-full text-sm w-fit"></span>
        <span id="intentChip" class="px-3 py-1 rounded-full text-sm w-fit"></span>
        <span id="observedChip" class="px-3 py-1 rounded-full text-sm w-fit"></span>
      </div>
    </section>

    <!-- CAPABILITY -->
    <section class="card p-6">
      <h3 class="font-medium">Entity Capability (Static Crawl)</h3>
      <p class="muted text-sm mb-4">
        Structural clarity derived exclusively from static crawl.
      </p>

      <div class="w-full bg-slate-800 rounded h-4 overflow-hidden">
        <div id="capabilityBar" class="h-4"></div>
      </div>

      <p id="capabilityScore" class="mt-2 text-sm muted"></p>
    </section>

    <!-- INTENT -->
    <section class="card p-6">
      <h3 class="font-medium">AI Intent Signals (Observed)</h3>
      <p class="muted text-sm mb-4">
        Detected via rendered crawl. Not scored.
      </p>

      <ul id="intentSignals" class="list-disc list-inside space-y-1 muted text-sm"></ul>
    </section>

    <!-- EVIDENCE -->
    <section class="card p-6">
      <details>
        <summary class="cursor-pointer font-medium">View Evidence</summary>
        <div id="breakdown" class="mt-4 space-y-2 text-sm"></div>
      </details>
    </section>

  </main>

  <script>
    const runBtn = document.getElementById("runBtn");
    const urlInput = document.getElementById("urlInput");
    const results = document.getElementById("results");

    runBtn.onclick = async () => {
      const url = urlInput.value.trim();
      if (!url) return;

      runBtn.textContent = "Running...";
      runBtn.disabled = true;

      const res = await fetch("/api/audit", {
        method: "POST",
        headers: { "Content-Type": "application/json" },
        body: JSON.stringify({ url })
      });

      const data = await res.json();
      render(data);

      runBtn.textContent = "Run Audit";
      runBtn.disabled = false;
    };

    function render(data) {
      results.classList.remove("hidden");

      document.getElementById("entityName").textContent = data.hostname;
      document.getElementById("quadrant").textContent = data.quadrant;

      document.getElementById("interpretation").textContent =
        `${data.ecc.band.toUpperCase()} capability · ${data.intent.posture.toUpperCase()} intent`;

      // Chips
      chip("capabilityChip", `Capability: ${data.ecc.band}`, data.ecc.band);
      chip("intentChip", `Intent: ${data.intent.posture}`, data.intent.posture);
      chip("observedChip", `Observed: ${data.intent.observedFrom.join(", ")}`, "neutral");

      // Capability bar
      const bar = document.getElementById("capabilityBar");
      bar.style.width = `${data.ecc.score}%`;
      bar.className = `h-4 ${bandColor(data.ecc.band)}`;

      document.getElementById("capabilityScore").textContent =
        `${data.ecc.score} / 100`;

      // Intent signals
      const intentList = document.getElementById("intentSignals");
      intentList.innerHTML = "";
      if (data.intent.signals.length === 0) {
        intentList.innerHTML = "<li>No explicit AI-forward behavior detected.</li>";
      } else {
        data.intent.signals.forEach(s => {
          const li = document.createElement("li");
          li.textContent = s;
          intentList.appendChild(li);
        });
      }

      // Breakdown
      const breakdown = document.getElementById("breakdown");
      breakdown.innerHTML = "";
      data.breakdown.forEach(b => {
        const row = document.createElement("div");
        row.className = "flex justify-between border-b border-slate-800 py-1";
        row.innerHTML = `
          <span>${b.key}</span>
          <span class="muted">${b.points}/${b.max}</span>
        `;
        breakdown.appendChild(row);
      });
    }

    function chip(id, text, band) {
      const el = document.getElementById(id);
      el.textContent = text;
      el.className = `px-3 py-1 rounded-full text-sm ${bandColor(band)}`;
    }

    function bandColor(band) {
      if (band === "high") return "bg-emerald-600";
      if (band === "medium") return "bg-amber-600";
      if (band === "low") return "bg-rose-600";
      return "bg-slate-600";
    }
  </script>
</body>
</html>
